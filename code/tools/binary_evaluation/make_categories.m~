
load('../..');

test_train_index = cell(size(fs_index),3);

temp_idx=1;
counter = 1;


fprintf('Build up Test-train data started...\n');
for i=1:size(fs_index)
    
cat = str2num(fs_index{i}(length(fs_index{i})-11:length(fs_index{i})-9));
test_train_index{i,1} = fs_index(i);
test_train_index{i,2} = cat;

if temp_idx<cat
    temp_idx=cat;
    counter=1;
end

if counter<31
    test_train_index{i,3}=1;
else
    test_train_index{i,3} = 0;
end
counter = counter+1;
end


fprintf('Make train set...\n');
train_set_index = find(cellfun(@(x) x==1, test_train_index(:,3)));
train_set= [train_set_index(:,1), cell2mat(test_train_index(train_set_index(:,1),2))];

fprintf('train SVM...\n');
%SVMStruct = svmtrain(feats(:,train_set(:,1)),train_set(:,2));
numInst = size(train_set,1);
numLabels = max(train_set(:,2));

%# Train one-against-all models
model = cell(numLabels,1);

for k=1:numLabels
    fprintf(num2str(k));
    model{k} = svmtrain(double(train_set(:,2)==k), double(feats(:,train_set(:,1))'), '-c 1 -g 0.2 -b 1');
    reverseStr = repmat(sprintf('\b'), 1, length(num2str(k)));
    fprintf(1,reverseStr);
end
